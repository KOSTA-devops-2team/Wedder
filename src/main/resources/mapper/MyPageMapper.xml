<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.wedder.mypage.dao.MyPageMapper">
	
	<sql id="selectFromMyPage">
		SELECT * FROM customer
	</sql>
	<sql id="selectFromCompany">
		select * from company
	</sql>
	<sql id="selectFromReservation">
		select * from reservation
	</sql>
	<sql id="selectFromHistory">
		select * from history
	</sql>
	<sql id="selectFromCoImage">
		select * from companyImage
	</sql>
	<!--0912  --> 
	<sql id="selectFromPackCa">
   		SELECT * FROM packageCategory
	</sql>
	<sql id="selectFromStudioInfo">
	    SELECT * FROM studioInfo
	</sql>
	<sql id="selectFromHallInfo">
	    SELECT * FROM hallInfo
	</sql>
	<sql id="selectFromMakeupInfo">
	    SELECT * FROM makeupInfo
	</sql>
	<sql id="selectFromDressInfo">
	    SELECT * FROM dressInfo
	</sql>
	<sql id="selectFromOptionDto">
	    SELECT * FROM optionDto
	</sql>
	
	<resultMap type="VisitCriteria" id="joinVisitCriteria">
	
		<association property="companyDto" javaType="CompanyDto">
			<result column="company_id" property="company_id"/>
			<result column="company_name" property="company_name"/>
			<result column="company_category" property="company_category"/>
			
		</association>
		
		<association property="myPageDTO" javaType="MyPageDTO">
			<result column="customer_id" property="customer_id"/>
			<result column="name" property="name"/>
		</association>
		
		<association property="reservationDto" javaType="ReservationDto">
			<result column="reservation_id" property="reservation_id"/>
			<result column="reservation_date" property="reservation_date"/>
			<result column="reservation_time" property="reservation_time"/>
		</association>
		
		<association property="historyDto" javaType="HistoryDto">
			<result column="reservation_status" property="reservation_status"/>
		</association>
		
		<association property="hallInfoDto" javaType="HallInfoDto">
			<result column="min_people" property="min_people"/>
		</association>
		
		<association property="companyImage" javaType="CompanyImage">
			<result column="img_url" property="img_url"/>
		</association>
		
		
	</resultMap>
	
	<!--selectOne  -->
	<select id="selectOne" parameterType="int" resultType="MyPageDTO">
		<include refid="selectFromMyPage"></include>
		WHERE customer_id=#{customer_id}
	</select>
	
	<select id="selectCompany" parameterType="int" resultType="CompanyDto">
		<include refid="selectFromCompany"></include>
		Where company_id=#{company_id} 
	</select>
	
	<select id="selectReservation" parameterType="int" resultType="ReservationDto">
		<include refid="selectFromReservation"></include>
		Where
		reservation_id = #{reservation_id}
	</select>
	
	<select id="selectHistory" parameterType="int" resultType="HistoryDto">
		<include refid="selectFromHistory"></include>
		WHERE customer_id=#{customer_id}
	</select>
	
	<select id="selectHallInfo" parameterType="int" resultType="HallInfoDto">
		<include refid="selectFromHallInfo"></include>
		WHERE hall_id=#{hall_id}
	</select>
	
	<select id="selectCoImage" parameterType="int" resultType="CompanyImage">
		<include refid="selectFromCoImage"></include>
		WHERE img_id =#{img_id}
	</select>
	
	<select id="selectPackCa" parameterType="int" resultType="PackageCategoryDto">
    <include refid="selectFromPackCa"></include>
    	WHERE category_id =#{category_id}
	</select>
	
	<select id="selectStudioInfo" parameterType="int" resultType="StudioInfo">
	    <include refid="selectFromStudioInfo"></include>
	    WHERE makeup_id =#{makeup_id}
	</select>
	
	<select id="selectMakeupInfo" parameterType="int" resultType="MakeupInfo">
	    <include refid="selectFromMakeupInfo"></include>
	    WHERE makeup_id =#{makeup_id}
	</select>
	
	<select id="selectDressInfo" parameterType="int" resultType="DressInfo">
	    <include refid="selectFromDressInfo"></include>
	    where dress_id =#{dress_id}
	</select>
	
	<select id="selectOptionDto" parameterType="int" resultType="optionDto">
	    <include refid="selectFromOptionDto"></include>
	    WHERE option_id =#{option_id}
	</select>
	
	<select id="todayVisitHistory" parameterType="map" resultMap="joinVisitCriteria" >
		SELECT company_name , name, reservation_date, reservation_time, reservation_status
		FROM reservation
		 JOIN company ON reservation.company_id = company.company_id
		 JOIN customer ON reservation.customer_id = customer.customer_id
		 JOIN history ON history.customer_id = customer.customer_id
		 Where customer.customer_id =#{customer_id} 
	</select>
	
	<select id="todayVisitCount" parameterType="map" resultType="int" >
		SELECT count(*)
		FROM reservation
		 JOIN company ON reservation.company_id = company.company_id
		 JOIN customer ON reservation.customer_id = customer.customer_id
		 JOIN history ON history.customer_id = customer.customer_id
		 Where customer.customer_id =#{customer_id} 
	</select>
	
	<select id="todayReservationHistory" parameterType="map" resultType="CompanyDto">
		<include refid="selectFromCompany"/>
		where company_category =#{company_category}
		order by company_id desc,company_name desc
	</select>
	
	<select id="hallVisitReservatioinList" parameterType="map" resultMap="joinVisitCriteria">
		select companyImage.img_url,			customer.name, company.company_name,
				reservation.reservation_date, 	reservation.reservation_time, hallInfo.min_people
		From reservation
			JOIN company 			ON 	company.company_id 		= reservation.company_id
    		JOIN customer 			ON 	reservation.customer_id 	= customer.customer_id
    		JOIN hallInfo 			ON 	reservation.company_id 	= hallInfo.company_id
    		JOIN companyImage 	ON 	companyImage.company_id = reservation.company_id
   		Where 	reservation.customer_id =	#{customer_id} 
   		and 		company.company_category=#{company_category}
   		and 		reservation.visit_reservation=#{visit_reservation}
	</select>
	<select id="coReservationList" parameterType="map" resultMap="joinVisitCriteria">
		select companyImage.img_url,customer.name, company.company_name,
				reservation.reservation_date, reservation.reservation_time
		From reservation
	         JOIN company 			ON 	company.company_id 			= reservation.company_id
	         JOIN customer 		ON 	reservation.customer_id 		= customer.customer_id
	         JOIN companyImage 	ON 	companyImage.company_id 		= reservation.company_id
		where   	customer.customer_id= #{customer_id}
	  	and   		company.company_category=#{company_category}
	</select> 
</mapper>